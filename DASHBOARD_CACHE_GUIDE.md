# Dashboard & UserProfile Caching System - ì‚¬ìš© ê°€ì´ë“œ

## ê°œìš”
ëŒ€ì‹œë³´ë“œ í†µê³„ ë° ìœ„ì¹˜ ì •ë³´ ë°ì´í„°ë¥¼ 24ì‹œê°„ ë™ì•ˆ ìºì‹œí•˜ì—¬ í˜ì´ì§€ ë¡œë”© ì†ë„ë¥¼ ëŒ€í­ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. ìºì‹± ì‹œìŠ¤í…œ (settings.py)
- **Backend**: FileBasedCache
- **ìœ„ì¹˜**: `/var/www/html/dj_voice_manage/cache/`
- **ìœ íš¨ ê¸°ê°„**: 24ì‹œê°„ (86400ì´ˆ)
- **ìµœëŒ€ í•­ëª©**: 1000ê°œ

### 2. ìºì‹œ ì ìš© í˜ì´ì§€

#### A. Dashboard View (í™”ì ê¸°ë°˜ í†µê³„)
- **URL**: `http://210.125.93.241:8010/audio/dashboard/`
- **ìºì‹œ í‚¤**: `dashboard_statistics`
- **ì²˜ë¦¬ ì‹œê°„**: 
  - ìºì‹œ ë¯¸ìŠ¤: ~46ì´ˆ (DB ì¿¼ë¦¬)
  - ìºì‹œ íˆíŠ¸: ~0.1ì´ˆ (ì¦‰ì‹œ ë°˜í™˜)
- **í†µê³„ ë‚´ìš©**:
  - ì´ í™”ì ìˆ˜ ë° íŒŒì¼ ìˆ˜
  - ì¹´í…Œê³ ë¦¬ë³„/ì„±ë³„ í†µê³„
  - SNR í’ˆì§ˆ ë¶„ì„
  - ì›”ë³„ ì¶”ì´
  - ì§„ë‹¨ëª…ë³„ í†µê³„

#### B. UserProfile View (ìœ„ì¹˜ ì •ë³´)
- **URL**: `http://210.125.93.241:8010/api/userprofile/`
- **ìºì‹œ í‚¤**: `userprofile_statistics`
- **ì²˜ë¦¬ ì‹œê°„**:
  - ìºì‹œ ë¯¸ìŠ¤: ~0.3ì´ˆ (ì§€ì—­ ë°ì´í„° ì§‘ê³„)
  - ìºì‹œ íˆíŠ¸: ~0.05ì´ˆ (ì¦‰ì‹œ ë°˜í™˜)
- **í†µê³„ ë‚´ìš©**:
  - ì§€ì—­ë³„ ë°ì´í„° ì „ì†¡ ìœ„ì¹˜
  - IP ê¸°ë°˜ ì ‘ê·¼ ìœ„ì¹˜
  - ì§€ë„ ì‹œê°í™” ë°ì´í„°

### 3. ê´€ë¦¬ ëª…ë ¹ì–´
```bash
# ëª¨ë“  ìºì‹œ ê°±ì‹  (ëŒ€ì‹œë³´ë“œ + ìœ„ì¹˜ ì •ë³´)
cd /var/www/html/dj_voice_manage
python manage.py refresh_dashboard_cache
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
[2025-11-27 13:38:19] ìºì‹œ ê°±ì‹  ì‹œì‘...

[1/2] ëŒ€ì‹œë³´ë“œ í†µê³„ ë°ì´í„° ê³„ì‚° ì¤‘...
âœ“ ëŒ€ì‹œë³´ë“œ ìºì‹œ ê°±ì‹  ì™„ë£Œ (ì†Œìš” ì‹œê°„: 45.69ì´ˆ)
  - ì´ í™”ì ìˆ˜: 186
  - ì´ íŒŒì¼ ìˆ˜: 6282

[2/2] ìœ„ì¹˜ ì •ë³´ í†µê³„ ë°ì´í„° ê³„ì‚° ì¤‘...
âœ“ ìœ„ì¹˜ ì •ë³´ ìºì‹œ ê°±ì‹  ì™„ë£Œ (ì†Œìš” ì‹œê°„: 0.30ì´ˆ)
  - ì´ ì—…ë¡œë“œ ìœ„ì¹˜: 2ê°œ ì§€ì—­
  - ì´ ì—…ë¡œë“œ íšŸìˆ˜: 5

âœ“ ì „ì²´ ìºì‹œ ê°±ì‹  ì™„ë£Œ (ì´ ì†Œìš” ì‹œê°„: 45.99ì´ˆ)
  - ê°±ì‹  ì‹œê°: 2025-11-27 13:38:19
  - ìºì‹œ ìœ íš¨ ê¸°ê°„: 24ì‹œê°„
```

### 4. í¬ë¡ ì¡ (ìë™ ê°±ì‹ )
**ì„¤ì •**: ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ ì‹¤í–‰
```bash
0 3 * * * cd /var/www/html/dj_voice_manage && /home/tyoon/anaconda3/envs/aligner/bin/python manage.py refresh_dashboard_cache >> /var/www/html/dj_voice_manage/cache_refresh.log 2>&1
```

**í™•ì¸ ë°©ë²•:**
```bash
# í¬ë¡ ì¡ ëª©ë¡ í™•ì¸
crontab -l

# ê°±ì‹  ë¡œê·¸ í™•ì¸
tail -f /var/www/html/dj_voice_manage/cache_refresh.log
```

### 5. ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤

#### ìºì‹œ ìƒíƒœ í‘œì‹œ
ëŒ€ì‹œë³´ë“œ ìƒë‹¨ì— ìºì‹œ ìƒíƒœ ë°°ì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤:
- **íŒŒë€ìƒ‰ ë°°ì§€**: ìºì‹œ ë°ì´í„° ì‚¬ìš© ì¤‘ (ë¹ ë¥¸ ë¡œë”©)
  ```
  ğŸ”µ ìºì‹œ ë°ì´í„° (ì—…ë°ì´íŠ¸: 2025-11-27 13:28:27)
  ```
- **ì´ˆë¡ìƒ‰ ë°°ì§€**: ìµœì‹  ë°ì´í„°ë¡œ ê°±ì‹ ë¨
  ```
  ğŸŸ¢ ìµœì‹  ë°ì´í„° (ê°±ì‹ : 2025-11-27 13:28:27)
  ```

#### ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥
**ë°ì´í„° ê°±ì‹  ë²„íŠ¼** (staff ì‚¬ìš©ìë§Œ í‘œì‹œ)
- ìœ„ì¹˜: ëŒ€ì‹œë³´ë“œ ìš°ì¸¡ ìƒë‹¨
- ê¸°ëŠ¥: ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  ìµœì‹  ë°ì´í„°ë¡œ ì¦‰ì‹œ ê°±ì‹ 
- URL: `http://210.125.93.241:8010/audio/dashboard/?refresh=1`

## ì„±ëŠ¥ ë¹„êµ

### Dashboard (í™”ì í†µê³„)
| êµ¬ë¶„ | ì´ì „ | ì´í›„ (ìºì‹œ íˆíŠ¸) | ê°œì„ ìœ¨ |
|------|------|------------------|--------|
| ë¡œë”© ì‹œê°„ | ~46ì´ˆ | ~0.1ì´ˆ | **99.8% ê°œì„ ** |
| DB ì¿¼ë¦¬ | ë§¤ë²ˆ ì‹¤í–‰ | í•˜ë£¨ 1íšŒ | **ë§¤ìš° íš¨ìœ¨ì ** |

### UserProfile (ìœ„ì¹˜ ì •ë³´)
| êµ¬ë¶„ | ì´ì „ | ì´í›„ (ìºì‹œ íˆíŠ¸) | ê°œì„ ìœ¨ |
|------|------|------------------|--------|
| ë¡œë”© ì‹œê°„ | ~0.3ì´ˆ | ~0.05ì´ˆ | **83% ê°œì„ ** |
| DB ì¿¼ë¦¬ | ë§¤ë²ˆ ì‹¤í–‰ | í•˜ë£¨ 1íšŒ | **ë§¤ìš° íš¨ìœ¨ì ** |

**ì „ì²´ íš¨ê³¼:**
- âœ… ì‚¬ìš©ì ê²½í—˜ **íšê¸°ì  ê°œì„ **
- âœ… ì„œë²„ ë¶€í•˜ **ëŒ€í­ ê°ì†Œ**
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ **ìµœì†Œí™”**

## ë™ì‘ íë¦„

```mermaid
graph TD
    A[ì‚¬ìš©ìê°€ ëŒ€ì‹œë³´ë“œ ì ‘ì†] --> B{ìºì‹œ í™•ì¸}
    B -->|ìºì‹œ ìˆìŒ| C[ìºì‹œ ë°ì´í„° ë°˜í™˜<br/>~0.1ì´ˆ]
    B -->|ìºì‹œ ì—†ìŒ| D[DB ì¿¼ë¦¬ ì‹¤í–‰<br/>~46ì´ˆ]
    D --> E[í†µê³„ ê³„ì‚°]
    E --> F[ìºì‹œì— ì €ì¥<br/>24ì‹œê°„ ìœ íš¨]
    F --> G[ë°ì´í„° ë°˜í™˜]
    C --> H[ëŒ€ì‹œë³´ë“œ í‘œì‹œ]
    G --> H
    
    I[í¬ë¡ ì¡<br/>ë§¤ì¼ 03:00] --> J[ìºì‹œ ìë™ ê°±ì‹ ]
    J --> F
    
    K[ê´€ë¦¬ì ìˆ˜ë™ ê°±ì‹ <br/>?refresh=1] --> D
```

## í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. Dashboard ì´ˆê¸° ë¡œë”© í…ŒìŠ¤íŠ¸ (ìºì‹œ ë¯¸ìŠ¤)
```bash
# ëŒ€ì‹œë³´ë“œ ìºì‹œë§Œ ì‚­ì œ
rm -f /var/www/html/dj_voice_manage/cache/*dashboard_statistics*

# ëŒ€ì‹œë³´ë“œ ì ‘ì†
# http://210.125.93.241:8010/audio/dashboard/
# -> ì´ˆë¡ìƒ‰ ë°°ì§€ í‘œì‹œ, ì•½ 46ì´ˆ ì†Œìš”
```

### 2. UserProfile ì´ˆê¸° ë¡œë”© í…ŒìŠ¤íŠ¸ (ìºì‹œ ë¯¸ìŠ¤)
```bash
# ìœ„ì¹˜ ì •ë³´ ìºì‹œë§Œ ì‚­ì œ
rm -f /var/www/html/dj_voice_manage/cache/*userprofile_statistics*

# ìœ„ì¹˜ ì •ë³´ í˜ì´ì§€ ì ‘ì†
# http://210.125.93.241:8010/api/userprofile/
# -> ì´ˆë¡ìƒ‰ ë°°ì§€ í‘œì‹œ, ì•½ 0.3ì´ˆ ì†Œìš”
```

### 3. ìºì‹œ íˆíŠ¸ í…ŒìŠ¤íŠ¸
```bash
# ìœ„ í…ŒìŠ¤íŠ¸ ì§í›„ ë‹¤ì‹œ ì ‘ì†
# -> íŒŒë€ìƒ‰ ë°°ì§€ í‘œì‹œ, ì¦‰ì‹œ ë¡œë”©
```

### 4. ê°•ì œ ê°±ì‹  í…ŒìŠ¤íŠ¸ (ê´€ë¦¬ì ì „ìš©)
```bash
# ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í›„
# Dashboard: http://210.125.93.241:8010/audio/dashboard/?refresh=1
# UserProfile: http://210.125.93.241:8010/api/userprofile/?refresh=1
# -> ì´ˆë¡ìƒ‰ ë°°ì§€ í‘œì‹œ, ìºì‹œ ê°•ì œ ê°±ì‹ 
```

## ìºì‹œ ê´€ë¦¬

### ìºì‹œ í™•ì¸
```bash
# ìºì‹œ ë””ë ‰í† ë¦¬ í™•ì¸
ls -lh /var/www/html/dj_voice_manage/cache/

# ëŒ€ì‹œë³´ë“œ ìºì‹œ í™•ì¸
ls -lh /var/www/html/dj_voice_manage/cache/*dashboard_statistics*

# ìœ„ì¹˜ ì •ë³´ ìºì‹œ í™•ì¸
ls -lh /var/www/html/dj_voice_manage/cache/*userprofile_statistics*

# ìºì‹œ íŒŒì¼ ì „ì²´ í¬ê¸° í™•ì¸
du -sh /var/www/html/dj_voice_manage/cache/
```

### ìºì‹œ ì‚­ì œ (ë¬¸ì œ ë°œìƒì‹œ)
```bash
# ì „ì²´ ìºì‹œ ì‚­ì œ
rm -rf /var/www/html/dj_voice_manage/cache/

# ëŒ€ì‹œë³´ë“œ ìºì‹œë§Œ ì‚­ì œ
rm -f /var/www/html/dj_voice_manage/cache/*dashboard_statistics*

# ìœ„ì¹˜ ì •ë³´ ìºì‹œë§Œ ì‚­ì œ
rm -f /var/www/html/dj_voice_manage/cache/*userprofile_statistics*
```

### ìˆ˜ë™ ê°±ì‹  (ì¦‰ì‹œ ë°˜ì˜ í•„ìš”ì‹œ)
```bash
# ëª¨ë“  ìºì‹œ ê°±ì‹  (ê¶Œì¥)
cd /var/www/html/dj_voice_manage
python manage.py refresh_dashboard_cache

# ë˜ëŠ” ì›¹ì—ì„œ ê°•ì œ ìƒˆë¡œê³ ì¹¨ (ê´€ë¦¬ìë§Œ)
# ?refresh=1 íŒŒë¼ë¯¸í„° ì‚¬ìš©
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ: ìºì‹œê°€ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ
**í•´ê²° ë°©ë²•:**
1. ìºì‹œ ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
   ```bash
   ls -ld /var/www/html/dj_voice_manage/cache/
   # tyoon:tyoon ì†Œìœ  í™•ì¸
   ```

2. ìˆ˜ë™ ê°±ì‹  ì‹¤í–‰
   ```bash
   python manage.py refresh_dashboard_cache
   ```

### ë¬¸ì œ: í¬ë¡ ì¡ì´ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
**í•´ê²° ë°©ë²•:**
1. í¬ë¡ ì¡ ì„¤ì • í™•ì¸
   ```bash
   crontab -l
   ```

2. í¬ë¡  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
   ```bash
   systemctl status cron  # Ubuntu/Debian
   # ë˜ëŠ”
   systemctl status crond  # CentOS/RHEL
   ```

3. ë¡œê·¸ í™•ì¸
   ```bash
   tail -f /var/www/html/dj_voice_manage/cache_refresh.log
   ```

### ë¬¸ì œ: í†µê³„ê°€ ì˜¤ë˜ë¨ (24ì‹œê°„ ì´ìƒ)
**í•´ê²° ë°©ë²•:**
- ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ í›„ "ë°ì´í„° ê°±ì‹ " ë²„íŠ¼ í´ë¦­
- ë˜ëŠ” URLì— `?refresh=1` ì¶”ê°€

## í–¥í›„ ê°œì„  ê°€ëŠ¥ ì‚¬í•­

1. **ìºì‹œ ì›Œë°**: ì„œë²„ ì‹œì‘ì‹œ ìë™ìœ¼ë¡œ ìºì‹œ ìƒì„±
2. **ë¶€ë¶„ ìºì‹œ**: ì¹´í…Œê³ ë¦¬ë³„, í™”ìë³„ë¡œ ê°œë³„ ìºì‹œ
3. **Redis ë„ì…**: ë” ë¹ ë¥¸ ìºì‹œ ì„±ëŠ¥ ë° í´ëŸ¬ìŠ¤í„°ë§ ì§€ì›
4. **ìºì‹œ ë§Œë£Œ ì•Œë¦¼**: ìºì‹œê°€ ê³§ ë§Œë£Œë  ë•Œ ìë™ ê°±ì‹ 
5. **ì‹¤ì‹œê°„ í†µê³„**: WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (ì„ íƒì )

## ì½”ë“œ ìœ„ì¹˜

- **Settings**: `/var/www/html/dj_voice_manage/voice_project/settings.py` (ë¼ì¸ 138-146)
- **Dashboard View**: `/var/www/html/dj_voice_manage/voice_app/views.py` (dashboard í•¨ìˆ˜)
- **UserProfile View**: `/var/www/html/dj_voice_manage/voice_app/views.py` (userprofile í•¨ìˆ˜)
- **Dashboard Template**: `/var/www/html/dj_voice_manage/voice_app/templates/voice_app/dashboard.html`
- **UserProfile Template**: `/var/www/html/dj_voice_manage/voice_app/templates/voice_app/userprofile.html`
- **Management Command**: `/var/www/html/dj_voice_manage/voice_app/management/commands/refresh_dashboard_cache.py`
- **Cron Setup**: ê°€ì´ë“œëŠ” `CACHE_SETUP_GUIDE.sh` ì°¸ì¡°

## ê²°ë¡ 

ìºì‹± ì‹œìŠ¤í…œ ë„ì…ìœ¼ë¡œ:
- âœ… Dashboard ë¡œë”© ì†ë„ **99.8% ê°œì„ ** (46ì´ˆ â†’ 0.1ì´ˆ)
- âœ… UserProfile ë¡œë”© ì†ë„ **83% ê°œì„ ** (0.3ì´ˆ â†’ 0.05ì´ˆ)
- âœ… DB ë¶€í•˜ **ëŒ€í­ ê°ì†Œ** (í•˜ë£¨ 1íšŒ ì¿¼ë¦¬)
- âœ… ì‚¬ìš©ì ê²½í—˜ **íšê¸°ì  ê°œì„ **
- âœ… ìë™ ê°±ì‹ ìœ¼ë¡œ **ê´€ë¦¬ í¸ì˜ì„± í–¥ìƒ**
